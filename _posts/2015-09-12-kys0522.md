---
title: 메모리 덤프 분석 보조 도구
subtitle: 프로그램을 죽인 범인을 찾자
author: 김용수 책임
layout: post
icon: fa-trash-alt
image: assets/images/post/kys0522/dumpMain.bmp
profileimage: assets/images/speaker/kys0522.jpg
hashtags: 
  - 메모리
  - 메모리덤프
  - 비정상종료
  - 안정화
---

프로그램을 죽인 범인은 누굴까요? 어떻게 찾아야 할까요? 
우리가 늘 하고 있는 디버깅과 크게 다르지 않습니다.
하나씩 살펴볼까요?

## 메모리 덤프란?
프로그램이 실행하면서 사용중인 메모리 공간을 그대로 파일로 만든것 입니다.
실행코드 및 각종 데이터 들이 포함될 수 있습니다.

<span class="image centered"><img src="{{ 'assets/images/post/kys0522/dumpMain.bmp' | relative_url }}" alt="" /></span>

우리는 과거 이러한 화면을 많이 봤었습니다. 윈도우가 비정상 종료할 떄 뜨던 상황이었죠.
자세히 보시면 메모리를 파일로 덤프하는 순간입니다. 비정상 종료하는 순간의 상태를 기록하는 것이죠.

<center> 프로그램의 메모리 구조 </center>
<span class="image centered"><img src="{{ 'assets/images/post/kys0522/memory.png' | relative_url }}" alt="" /></span>

문제해결을 위해서 항상 모든 메모리가 필요한 것은 아닙니다. 많은 경우 최소한의 정보를 담은 미니 덤프로도 충분할 것입니다.
미니 덤프는 다음과 같은 특성을 가집니다.
- 작은 용량 (1mb 내외)
- 레지스터
- 콜 스택
- 프로세스/스레드 정보
- 오류 발생 지점 근처 데이터

## 프로그램이 죽은 원인?
프로그램이 죽은 원인에는 무엇무엇이 있을까요? 우리가 흔히 접할 수 잇는 예외 목록을 먼저 살펴보도록 하겠습니다.

<span class="image centered"><img src="{{ 'assets/images/post/kys0522/exceptionList.png' | relative_url }}" alt="" /></span>

우리가 사용하는 IDE에서는 정확하게 예외상황을 잡고 멈춰주지만, Release 제품의 경우는 이것을 기대할 수는 없을 것입니다. 처리되지 않은 예외가 발생했을 때 제품은 그대로 비정상 종료하게 됩니다. 다행인것은, 프로그램이 죽는 그 순간에, 프로그램은 자신의 상태를 기록할 수 있습니다. **윈도우가 죽을떄 파란화면을 띄우는 것 처럼요.**

## 다른 프로그램은 어떻게 할까?
개발 조직의 규모와 관계 없이 완벽한 상태의 제품을 사용자에게 전달하는 것은 불가능이라해도 과언이 아닙니다. 다음과 같은 이유들 때문인데요.
- 사용자의 다양한 HW/SW 상태
- 예측하기 어려운 다양한 입력 데이터
- 모든 사용 시나리오 도출/실행이 어렵다

다양한 플랫폼에서 개발된 수많은 SW들이 비정상 종료를 해결하기 위해서 아래 사진과 같이 메모리덤프를 수집하여 문제해결을 시도하고있습니다.

<span class="image centered"><img src="{{ 'assets/images/post/kys0522/crashRpt.jpg' | relative_url }}" alt="" /></span>

결국 사용자에게 발생하는 상황들을 수집하고, 점차 개선해 나가는 것이 최선입니다. 이를 위해서 최소한의 정보를 담은 미니 메모리 덤프를 수집합니다. 이렇게 수집한 메모리덤프를 분석하여 제품이 비정상 종료 하는 시점의 상태를 파악하고 문제를 예방/회피하면서 제품을 안정화 할 수 있습니다.

<hr/>
<br>

## 그래서 어떻게 고치지지?
이러한 예외가 발생했을 때 그 예외가 핸들링 되지 않았다면, 프로그램은 비정상 종료하게 됩니다.

## 덤프를 관리할 때는?
가장 좋은 것은 사용자에게 전달되기 전에 모든 문제가 해결되는 것이겠지만, 현실적으로는 불가능합니다.
- 모든 사용 시나리오 도출의 어려움
- 사용자의 다양한 HW 상태

모든 사용 시나리오를 고려할 수 없으며, 사용자의 HW 상태 또한 수도 없이 다양하기 때문입니다.

<hr/>
<br>

## 유용한 도구에는 뭐가 있을까?

### 1. Visual Studio
니ㅏ어리넝
ㄹ나어리나ㅓ

### 2. windbg
ㄴㅇ라넝ㄹ
ㄴㅇㄹㄴㅇㄹ



## 덤프 분석 도구
스샤이란
이렇게 ㅆ











Markdown | Less | Pretty
--- | --- | ---
*Still* | `renders` | **nicely**
1 | 2 | 3